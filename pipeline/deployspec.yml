#
# deployspec.yml
#

version: 0.2

env:
  variables:
    target_host_name: www14.lib.virginia.edu
    target_host_user: bamboo

phases:
  install:
    runtime-versions:
      nodejs: 10
#    commands:

  pre_build:
    commands:
      - TODAYS_DATE=$(date +"%Y%m%d")

  build:
    commands:
      - LATEST_ASSETS_FILE=$(aws s3 ls s3://$BUCKET_NAME/$TODAYS_DATE | grep assets | head -1 | awk '{print $4}')
      - aws s3 cp s3://$BUCKET_NAME/$LATEST_ASSETS_FILE .
      - mkdir $CODEBUILD_SRC_DIR/assets
      - cd $CODEBUILD_SRC_DIR/assets
      - tar xzvf $CODEBUILD_SRC_DIR/$LATEST_ASSETS_FILE .
      # do the rsync
      #- rsync -av $CODEBUILD_SRC_DIR/assets/build/es6-unbundled/ $target_host_user@$target_host_name:/wwwstatic
      #- rsync -av $CODEBUILD_SRC_DIR/assets/data/ $target_host_user@$target_host_name:/wwwstatic/data

#  post_build:
#    commands:

#
# end of file
#
