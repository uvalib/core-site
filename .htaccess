RewriteEngine on
RewriteBase /

# disable pwa on wwwstatic
RewriteCond %{HTTP_HOST} !^www\.library\.virginia\.edu
RewriteRule ^manifest.json$ - [F,L]
RewriteCond %{HTTP_HOST} !^www\.library\.virginia\.edu
RewriteRule ^push-manifest.json$ - [F,L]
RewriteCond %{HTTP_HOST} !^www\.library\.virginia\.edu
RewriteRule ^service-worker.js$ - [F,L]
RewriteCond %{HTTP_HOST} !^www\.library\.virginia\.edu
RewriteRule ^/$ - [F,L]
RewriteCond %{HTTP_HOST} !^www\.library\.virginia\.edu
RewriteRule ^/robots.txt$ no-robots.txt [L]


# TODO: make these feeds static and pull from a static server
RewriteCond %{REQUEST_METHOD}  =GET
RewriteCond %{HTTP_USER_AGENT} "AmazonAPIGateway"
RewriteRule "^rawAPI/(.*)$" "https://drupal.lib.virginia.edu/$1" [P]

# Give Bots the non-js version
RewriteCond %{HTTP_USER_AGENT} (bot|agent|spider|crawler|extractor) [NC]
RewriteCond %{HTTP_USER_AGENT} (Googlebot|bingbot|msnbot|facebookexternalhit|Facebot|Twitterbot|Google-Structured-Data-Testing-Tool) [NC]
RewriteCond %{REQUEST_URI} !^/data/pages/.*$
RewriteRule ^(.*)$ data/pages/$1 [L]


#Proxy this so that we can use http push to pull it in
RewriteRule "^piwik.js$" "https://analytics.lib.virginia.edu/piwik.js" [P]

Header set Access-Control-Allow-Origin "*"
#H2PushResource /src/uvalib-article.html
#H2PushResource /fonts/franklingothic-book-webfont.woff2
#H2PushResource /bower_component/moment-timezone/builds/moment-timezone-with-data.min.js
#H2PushResource /bower_components/iron-selector/iron-selection.html
#H2PushResource /bower_components/iron-selector/iron-selectable.html

Redirect /civilwarvirginia http://explore.lib.virginia.edu/exhibits/show/voicesofcivilwarvirginia
Redirect /digitization-guidelines http://guides.lib.virginia.edu/content.php?pid=40437&sid=297543
Redirect /give http://giving.virginia.edu/uvalibrary
Redirect /givingtohoosday http://givingtohoosday.virginia.edu/library?appealcode=MGTHALDP
Redirect /libraries https://www.library.virginia.edu/hours
Redirect /organization   http://static.lib.virginia.edu/directory/organization.html
Redirect /site-search https://www.library.virginia.edu/search
Redirect /sitesearch https://www.library.virginia.edu/search
Redirect /staff  http://static.lib.virginia.edu/directory/
Redirect /support/ http://static.lib.virginia.edu/campaign/
